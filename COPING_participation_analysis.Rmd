---
title: "COPING_participation_analysis"
author: "Steven Bright"
date: "04/09/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Clean global environment}

remove(list = ls())

```

#Call libraries

```{r Install packages}

#install.packages("tidyverse")

```

```{r Load libraries}

library(tidyverse)

```

#Read in data

```{r Source paths}

source("..//COPING_participation_paths.r")

```

```{r Read in glad coping participation data}

glad_coping_participation_raw <- read_rds(paste0(processed_data_path, processed_data_name))

#Check data
glad_coping_participation_raw %>% 
  head()

```

#Create tables for chi2 tests

Sociodemographic variables:

Age (continuous - Not applicable)
Gender
Ethnicity
Education
Employment
Partnership status

```{r Create contingency table for gender}

gender_contingency_table <- table(glad_coping_participation_raw$gender_recode_labelled,
                                  glad_coping_participation_raw$completed_baseline_labelled)

#Check output
gender_contingency_table

```

```{r Create contingency table for ethnicity}

ethnicity_contingency_table <- table(glad_coping_participation_raw$ethnicity_labelled,
                                     glad_coping_participation_raw$completed_baseline_labelled)

#Check output
ethnicity_contingency_table

```

```{r Create contingency table for Education}

education_contingency_table <- table(glad_coping_participation_raw$highest_education,
                                     glad_coping_participation_raw$completed_baseline_labelled)

#Check output
education_contingency_table

```

```{r Create contingency table for employment}

employment_contingency_table <- table(glad_coping_participation_raw$employment_labelled,
                                      glad_coping_participation_raw$completed_baseline_labelled)

#Check output
employment_contingency_table

```

```{r Partnership status}

partnership_contingency_table <- table(glad_coping_participation_raw$partnership_status_labelled,
                                       glad_coping_participation_raw$completed_baseline_labelled)

#Check output
partnership_contingency_table

```

#Run Aim 1 tests

The aim here is to see whether there are any significant differences between 
the GLAD Study paticipants who did and did not take part in the COPING baseline
regarding their sociodremographic background.

##Chi2 tests

```{r Set significance value}

sig_level <- 0.05

```

```{r Chi2 test for gender}

gender_chi2_test <- chisq.test(gender_contingency_table,
           correct = TRUE)

#Check output
gender_chi2_test

```

```{r Post hoc testing for gender}

#Get the adjusted residuals 
chisq.test(gender_contingency_table, 
           correct = TRUE)$stdres

#Adjust for multiple testing with Bonferonni
adj_sig_gender_chi2 <- sig_level/(nrow(gender_contingency_table) * ncol(gender_contingency_table))
adj_sig_gender_chi2

#Critical Z value
qnorm(adj_sig_gender_chi2/2)

```


```{r Chi2 test for ethnicity}

ethnicity_chi2_test <- chisq.test(ethnicity_contingency_table,
           correct = TRUE)

#Check output
ethnicity_chi2_test

```

```{r Chi2 test for education}

education_chi2_test <- chisq.test(education_contingency_table,
           correct = TRUE)

#Check output
education_chi2_test

```

```{r Chi2 test for employment}

employment_chi2_test <- chisq.test(employment_contingency_table,
           correct = TRUE)

#Check output
employment_chi2_test

```

```{r Chi2 test for partnership status}

partnership_chi2_test <- chisq.test(partnership_contingency_table,
           correct = TRUE)

#Check output
partnership_chi2_test

```

##Logistic regression models

We will run four logistic regression models for aim 1:

Model 1: Sociodemographic variables
Model 2: Psychiatric and health variables
Model 3: Study variables
Model 4: All variables together

```{r Model 1: sociodemographic variables}

sociodemographic_LR_model <- glm(
  formula = completed_baseline ~ age_cleaned + 
    gender_recode +
    highest_education +
    dem.questions_based_ethnic_origin +
    dem.what_is_your_current_employment_status +
    partnership_status,
  family = "binomial",
  data = glad_coping_participation_raw)

#Check output
summary(sociodemographic_LR_model)

```


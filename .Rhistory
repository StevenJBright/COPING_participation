replacement = "")
#Name COPING GLAD base files
COPING_GLAD_base_files_renamed <- COPING_GLAD_base_files %>%
setNames(COPING_GLAD_base_dataset_names)
#Get file names of COPING GLAD data sets in COPING GLAD base path
COPING_followup_A_directory <- list.files(COPING_followup_A_path)
#Create empty list equal to the no. of files in the directory
COPING_followup_A_files <- vector("list", length(COPING_followup_A_directory))
#Pass the vector with file names one by one to readRDS --> GLAD sign up path
COPING_followup_A_files <- COPING_followup_A_directory %>%
map(function(file_name){
read_csv(paste0(COPING_followup_A_path, file_name))
})
#Save object with .rds removed from file names
COPING_followup_A_dataset_names <- COPING_followup_A_directory %>%
gsub(pattern = ".csv",
replacement = "")
#Name COPING GLAD base files
COPING_followup_A_files_renamed <- COPING_followup_A_files %>%
setNames(COPING_followup_A_dataset_names)
COPING_followup_B_phq_raw <- read_csv(COPING_followup_B_path)
#Check data
COPING_followup_B_phq_raw %>%
dim()
COPING_followup_July2021 <- read_csv(COPING_followup_July2021_path)
COPING_followup_July2021 %>%
head()
COPING_followup_July2021 %>%
dim()
COPING_followup_3months <- read_csv(COPING_followup_3months_path)
COPING_followup_3months %>%
head()
COPING_followup_3months %>%
dim()
#Assign to individual objects
COPING_followup_A_dem_raw <- COPING_followup_A_files_renamed$COPING_followup_A_finished
COPING_followup_A_ongo_raw <- COPING_followup_A_files_renamed$COPING_followup_A_ongoing_finished
#Find colnames that don't match
setdiff(colnames(COPING_followup_A_dem_raw), colnames(COPING_followup_A_ongo_raw))
#Rename non-matching cols in COPING follow-up A
#COPING_followup_A_dem_raw <- COPING_followup_A_dem_raw %>%
#  rename("dem.age_children_living" = dem.age_living_children,
#         "dem.age_children_living.1" = dem.age_living_children.1)
#Merge data sets
COPING_followup_A_dem_merged <- COPING_followup_A_dem_raw %>%
rbind(COPING_followup_A_ongo_raw)
#Check results
COPING_followup_A_dem_merged %>%
head()
COPING_followup_A_dem_merged %>%
dim()
dim(COPING_followup_A_dem_raw)[1] + dim(COPING_followup_A_ongo_raw)[1]
# MAY 2 (wave 1) - FOLLOW UP A
start1 <- as.POSIXct("2020-05-19")
end1 <-  as.POSIXct("2020-06-02")
# JUNE 1 (wave 2) - FOLLOW UP B
start2 <- as.POSIXct("2020-06-02")
end2<-  as.POSIXct("2020-06-16")
# JUNE 2 (wave 3) - FOLLOW UP A
start3 <- as.POSIXct("2020-06-16")
end3 <-  as.POSIXct("2020-06-30")
# JULY 1 (wave 4) - FOLLOW UP B
start4 <- as.POSIXct("2020-06-30")
end4<-  as.POSIXct("2020-07-14")
# JULY 2 (wave 5) - FOLLOW UP A
start5 <- as.POSIXct("2020-07-14")
end5 <-  as.POSIXct("2020-07-28") ##Ongoing starts from here
# JULY - AUG (wave 6) - FOLLOW UP B
start6 <- as.POSIXct("2020-07-28")
end6 <-  as.POSIXct("2020-08-25")
# AUG - SEPT (wave 7) - FOLLOW UP A
start7 <- as.POSIXct("2020-08-25")
end7 <-  as.POSIXct("2020-09-22")
# SEPT - OCT (wave 8) - FOLLOW UP B
start8 <- as.POSIXct("2020-09-22")
end8 <-  as.POSIXct("2020-10-20")
# OCT - NOV (wave 9) - FOLLOW UP A
start9 <- as.POSIXct("2020-10-20")
end9 <-  as.POSIXct("2020-11-17")
# NOV - DEC (wave 10) - FOLLOW UP B
start10 <- as.POSIXct("2020-11-17")
end10 <-  as.POSIXct("2020-12-15")
# DEC - JAN (wave 11) - FOLLOW UP A
start11 <- as.POSIXct("2020-12-15")
end11 <-  as.POSIXct("2021-01-12")
# Jan - Feb (wave 12) - FOLLOW UP B
start12 <- as.POSIXct("2021-01-12")
end12 <- as.POSIXct("2021-02-09")
# Feb - March (wave 13) - FOLLOW UP A
start13 <- as.POSIXct("2021-02-09")
end13 <- as.POSIXct("2021-03-09")
# March - April (wave 14) - FOLLOW UP B
start14 <- as.POSIXct("2021-03-09")
end14 <- as.POSIXct("2021-04-06")
# April - May (wave 15) - FOLLOW UP A
start15 <- as.POSIXct("2021-04-06")
end15 <- as.POSIXct("2021-05-04")
# April - May (Wave 16) - Follow-up B
start16 <- as.POSIXct("2021-05-04")
end16 <- as.POSIXct("2021-06-01")
# June - late June (Wave 17) - Follow-up A
start17 <- as.POSIXct("2021-06-01")
end17 <- as.POSIXct("2021-06-29")
# June - late July (Wave 18) - Follow-up B
start18 <- as.POSIXct("2021-06-29")
end18 <- as.POSIXct("2021-07-27")
# July - August (Wave 19) - Three month follow-ups begin here
start19 <- as.POSIXct("2021-07-27")
end19 <- as.POSIXct("2021-10-26")
# October - January (Wave 20)
start20 <- as.POSIXct("2021-10-26")
end20 <- as.POSIXct("2022-01-25")
# January - April (Wave 21) - LAST FOLLOW-UP!
start21 <- as.POSIXct("2022-01-25")
end21 <- as.POSIXct("2022-04-26")
COPING_followup_A_dem_merged %>%
head()
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
))
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
View(COPING_followup_A_dem_waves)
View(COPING_followup_A_dem_waves)
COPING_followup_A_dem_merged$EndDate <- substr(COPING_followup_A_dem_merged$EndDate,
1,
nchar(COPING_followup_A_dem_merged$EndDate)-6)
COPING_followup_A_dem_merged_test <- COPING_followup_A_dem_merged %>%
mutate(EndDate =
as.Date(EndDate, format("%d/%M/%Y")))
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_merged_test <- COPING_followup_A_dem_merged %>%
mutate(EndDate =
as.Date(EndDate, format("%d/%M/%Y")),
EndDate =
EndDate + hours(1) + minutes(1) + seconds(1))
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged_test %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
)
)
COPING_followup_A_dem_merged_test <- COPING_followup_A_dem_merged %>%
mutate(EndDate =
as.Date(EndDate, format("%d/%M/%Y")),
EndDate =
as.character(EndDate + hours(1) + minutes(1) + seconds(1)))
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged_test %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
)
)
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
test <- readRDS(/Users/stevenbright/Library/CloudStorage/OneDrive-SharedLibraries-King'sCollegeLondon/MT-BioResource - SB_data_analysis - SB_data_analysis/COPING_participation_data/coping_followupa/dem_coping_followupa_ongoing.rds)
test <- readRDS("/Users/stevenbright/Library/CloudStorage/OneDrive-SharedLibraries-King'sCollegeLondon/MT-BioResource - SB_data_analysis - SB_data_analysis/COPING_participation_data/coping_followupa/dem_coping_followupa_ongoing.rds")
View(test)
test %>%
select(startDate) %>%
class(.)
test %>%
select(startDate) %>%
typeof(.)
test %>%
pull(startDate) %>%
typeof(.)
test %>%
pull(startDate) %>%
class(.)
COPING_followup_A_dem_merged_test <- COPING_followup_A_dem_merged %>%
mutate(EndDate =
as.POSIXct(EndDate, format("%d/%M/%Y"), tz = "gmt"))
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_merged_test %>%
pull(EndDate) %>%
class(.)
start1
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged_test %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
)
)
COPING_followup_A_dem_waves_test %>%
freq(COPING_waves_A)
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
# MAY 2 (wave 1) - FOLLOW UP A
start1 <- as.POSIXct("2020-05-19", tz = "gmt")
end1 <-  as.POSIXct("2020-06-02", tz = "gmt")
# JUNE 1 (wave 2) - FOLLOW UP B
start2 <- as.POSIXct("2020-06-02", tz = "gmt")
end2<-  as.POSIXct("2020-06-16", tz = "gmt")
# JUNE 2 (wave 3) - FOLLOW UP A
start3 <- as.POSIXct("2020-06-16", tz = "gmt")
end3 <-  as.POSIXct("2020-06-30", tz = "gmt")
# JULY 1 (wave 4) - FOLLOW UP B
start4 <- as.POSIXct("2020-06-30", tz = "gmt")
end4<-  as.POSIXct("2020-07-14", tz = "gmt")
# JULY 2 (wave 5) - FOLLOW UP A
start5 <- as.POSIXct("2020-07-14", tz = "gmt")
end5 <-  as.POSIXct("2020-07-28", tz = "gmt") ##Ongoing starts from here
# JULY - AUG (wave 6) - FOLLOW UP B
start6 <- as.POSIXct("2020-07-28", tz = "gmt")
end6 <-  as.POSIXct("2020-08-25", tz = "gmt")
# AUG - SEPT (wave 7) - FOLLOW UP A
start7 <- as.POSIXct("2020-08-25", tz = "gmt")
end7 <-  as.POSIXct("2020-09-22", tz = "gmt")
# SEPT - OCT (wave 8) - FOLLOW UP B
start8 <- as.POSIXct("2020-09-22", tz = "gmt")
end8 <-  as.POSIXct("2020-10-20", tz = "gmt")
# OCT - NOV (wave 9) - FOLLOW UP A
start9 <- as.POSIXct("2020-10-20", tz = "gmt")
end9 <-  as.POSIXct("2020-11-17", tz = "gmt")
# NOV - DEC (wave 10) - FOLLOW UP B
start10 <- as.POSIXct("2020-11-17", tz = "gmt")
end10 <-  as.POSIXct("2020-12-15", tz = "gmt")
# DEC - JAN (wave 11) - FOLLOW UP A
start11 <- as.POSIXct("2020-12-15", tz = "gmt")
end11 <-  as.POSIXct("2021-01-12", tz = "gmt")
# Jan - Feb (wave 12) - FOLLOW UP B
start12 <- as.POSIXct("2021-01-12", tz = "gmt")
end12 <- as.POSIXct("2021-02-09", tz = "gmt")
# Feb - March (wave 13) - FOLLOW UP A
start13 <- as.POSIXct("2021-02-09", tz = "gmt")
end13 <- as.POSIXct("2021-03-09", tz = "gmt")
# March - April (wave 14) - FOLLOW UP B
start14 <- as.POSIXct("2021-03-09", tz = "gmt")
end14 <- as.POSIXct("2021-04-06", tz = "gmt")
# April - May (wave 15) - FOLLOW UP A
start15 <- as.POSIXct("2021-04-06", tz = "gmt")
end15 <- as.POSIXct("2021-05-04", tz = "gmt")
# April - May (Wave 16) - Follow-up B
start16 <- as.POSIXct("2021-05-04", tz = "gmt")
end16 <- as.POSIXct("2021-06-01", tz = "gmt")
# June - late June (Wave 17) - Follow-up A
start17 <- as.POSIXct("2021-06-01", tz = "gmt")
end17 <- as.POSIXct("2021-06-29", tz = "gmt")
# June - late July (Wave 18) - Follow-up B
start18 <- as.POSIXct("2021-06-29", tz = "gmt")
end18 <- as.POSIXct("2021-07-27", tz = "gmt")
# July - August (Wave 19) - Three month follow-ups begin here
start19 <- as.POSIXct("2021-07-27", tz = "gmt")
end19 <- as.POSIXct("2021-10-26", tz = "gmt")
# October - January (Wave 20)
start20 <- as.POSIXct("2021-10-26", tz = "gmt")
end20 <- as.POSIXct("2022-01-25", tz = "gmt")
# January - April (Wave 21) - LAST FOLLOW-UP!
start21 <- as.POSIXct("2022-01-25", tz = "gmt")
end21 <- as.POSIXct("2022-04-26", tz = "gmt")
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged_test %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
)
)
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_merged_test <- COPING_followup_A_dem_merged %>%
mutate(EndDate =
date(as.POSIXct(EndDate, format("%d/%M/%Y"), tz = "gmt")))
COPING_followup_A_dem_merged_test %>%
head()
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged_test %>%
mutate(COPING_waves_A =
case_when(
EndDate >= start1 &
EndDate < end1 ~ ".Wave_1",
EndDate >= start3 &
EndDate < end3 ~ ".Wave_3",
EndDate >= start5 &
EndDate < end5 ~ ".Wave_5",
EndDate >= start7 &
EndDate < end7 ~ ".Wave_7",
EndDate >= start9 &
EndDate< end9 ~ ".Wave_9",
EndDate >= start11 &
EndDate < end11 ~ ".Wave_11",
EndDate >= start13 &
EndDate < end13 ~ ".Wave_13",
EndDate >= start15 &
EndDate < end15 ~ ".Wave_15",
EndDate >= start17 &
EndDate < end17 ~ ".Wave_17",
EndDate >= start19 &
EndDate < end19 ~ ".Wave_19",
EndDate >= start2 &
EndDate < end2 ~ ".Wave_2_QA",
EndDate >= start4 &
EndDate < end4 ~ ".Wave_4_QA",
EndDate >= start6 &
EndDate < end6 ~ ".Wave_6_QA",
EndDate >= start8 &
EndDate < end8 ~ ".Wave_8_QA",
EndDate >= start10 &
EndDate < end10 ~ ".Wave_10_QA",
EndDate >= start12 &
EndDate < end12 ~ ".Wave_12_QA",
EndDate >= start14 &
EndDate < end14 ~ ".Wave_14_QA",
EndDate >= start16 &
EndDate < end16 ~ ".Wave_16_QA",
EndDate >= start18 &
EndDate < end18 ~ ".Wave_18_QA",
EndDate > end21 ~ "Out of scope wave"
)
)
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
start7
end7

case_when(
mhd.an == 1 ~ 1,
mhd.atypical_an == 1 ~ 1,
mhd.bn == 1 ~ 1,
mhd.bed == 1 ~ 1,
(mhd.an == 0 &
mhd.atypical_an == 0 &
mhd.bn == 0 &
mhd.bed == 0 ~ 0
)
))
GLAD_signup_eating_disorders$eating_disorders_labelled <- factor(
GLAD_signup_eating_disorders$eating_disorders,
levels = c(0, 1),
labels = c("No eating disorder", "Eating disorder")
)
#Check results
GLAD_signup_eating_disorders %>%
group_by(eating_disorders_labelled) %>%
count()
GLAD_signup_eating_disorders$personality_disorder_labelled <- factor(
GLAD_signup_eating_disorders$mhd.personality_disorder,
levels = c(0, 1),
labels = c("No personality disorder", "Personality disorder")
)
#Check results
GLAD_signup_eating_disorders %>%
group_by(personality_disorder_labelled) %>%
count()
GLAD_signup_personality_disorders <- GLAD_signup_eating_disorders %>%
mutate(personality_cluster_A =
case_when(
mhd.personality_disorder_diagnosed == 1 ~ 1,
mhd.personality_disorder_diagnosed == 2 ~ 1,
mhd.personality_disorder_diagnosed == 3 ~ 1,
mhd.personality_disorder_diagnosed == 4 ~ 0,
mhd.personality_disorder_diagnosed == 5 ~ 0,
mhd.personality_disorder_diagnosed == 6 ~ 0,
mhd.personality_disorder_diagnosed == 7 ~ 0,
mhd.personality_disorder_diagnosed == 8 ~ 0,
mhd.personality_disorder_diagnosed == 9 ~ 0,
mhd.personality_disorder_diagnosed == 10 ~ 0,
)
)
GLAD_signup_personality_disorders$personality_cluster_A_labelled <- factor(
GLAD_signup_personality_disorders$personality_cluster_A,
levels = c(0, 1),
labels = c("No cluster A personality disorder", "Cluster A personality disorder")
)
#Check results
GLAD_signup_personality_disorders %>%
group_by(personality_cluster_A_labelled) %>%
count()
GLAD_signup_personality_disorders <- GLAD_signup_personality_disorders %>%
mutate(personality_cluster_B =
case_when(
mhd.personality_disorder_diagnosed == 1 ~ 0,
mhd.personality_disorder_diagnosed == 2 ~ 0,
mhd.personality_disorder_diagnosed == 3 ~ 0,
mhd.personality_disorder_diagnosed == 4 ~ 1,
mhd.personality_disorder_diagnosed == 5 ~ 1,
mhd.personality_disorder_diagnosed == 6 ~ 1,
mhd.personality_disorder_diagnosed == 7 ~ 1,
mhd.personality_disorder_diagnosed == 8 ~ 0,
mhd.personality_disorder_diagnosed == 9 ~ 0,
mhd.personality_disorder_diagnosed == 10 ~ 0,
)
)
GLAD_signup_personality_disorders$personality_cluster_B_labelled <- factor(
GLAD_signup_personality_disorders$personality_cluster_B,
levels = c(0, 1),
labels = c("No cluster B personality disorder", "Cluster B personality disorder")
)
#Check results
GLAD_signup_personality_disorders %>%
group_by(personality_cluster_B_labelled) %>%
count()
GLAD_signup_personality_disorders <- GLAD_signup_personality_disorders %>%
mutate(personality_cluster_C =
case_when(
mhd.personality_disorder_diagnosed == 1 ~ 0,
mhd.personality_disorder_diagnosed == 2 ~ 0,
mhd.personality_disorder_diagnosed == 3 ~ 0,
mhd.personality_disorder_diagnosed == 4 ~ 0,
mhd.personality_disorder_diagnosed == 5 ~ 0,
mhd.personality_disorder_diagnosed == 6 ~ 0,
mhd.personality_disorder_diagnosed == 7 ~ 0,
mhd.personality_disorder_diagnosed == 8 ~ 1,
mhd.personality_disorder_diagnosed == 9 ~ 1,
mhd.personality_disorder_diagnosed == 10 ~ 1,
)
)
GLAD_signup_personality_disorders$personality_cluster_C_labelled <- factor(
GLAD_signup_personality_disorders$personality_cluster_C,
levels = c(0, 1),
labels = c("No cluster C personality disorder", "Cluster C personality disorder")
)
#Check results
GLAD_signup_personality_disorders %>%
group_by(personality_cluster_C_labelled) %>%
count()
glad_signup_psychosis <- GLAD_signup_personality_disorders %>%
mutate(psychotic_disorder =
case_when(
mhd.schizophrenia == 1 ~ 1,
mhd.schizoaffective == 1 ~ 1,
mhd.psychosis == 1 ~ 1,
(mhd.schizophrenia == 0 &
mhd.schizoaffective == 0 |
is.na(mhd.schizoaffective) &
mhd.psychosis == 0 ~ 0
)
))
glad_signup_psychosis$psychotic_disorder_labelled <- factor(
glad_signup_psychosis$psychotic_disorder,
levels = c(0, 1),
labels = c("No psychotic disorder", "Psychotic disorder")
)
#Check results
glad_signup_psychosis %>%
group_by(psychotic_disorder_labelled) %>%
count()
glad_signup_psychosis$bipolar_disorder_labelled <- factor(
glad_signup_psychosis$mhd.bipolar_disorder,
levels = c(0, 1),
labels = c("No bipolar disorder", "Bipolar disorder")
)
#Check results
glad_signup_psychosis %>%
group_by(bipolar_disorder_labelled) %>%
count()
glad_signup_psychosis_and_bipolar <- glad_signup_psychosis %>%
mutate(psychotic_and_biploar_disorder =
case_when(
psychotic_disorder == 0 &
mhd.bipolar_disorder == 0 ~ 0,
psychotic_disorder == 1 &
mhd.bipolar_disorder == 1 ~ 1,
psychotic_disorder == 1 &
mhd.bipolar_disorder == 0 ~ 2,
psychotic_disorder == 0 &
mhd.bipolar_disorder == 1 ~ 3
))
glad_signup_psychosis_and_bipolar$psychotic_and_biploar_disorder_labelled <- factor(
glad_signup_psychosis_and_bipolar$psychotic_and_biploar_disorder,
levels = c(0, 1, 2, 3),
labels = c("0" = "No psychotic or bipolar disorder",
"1" = "Psychotic and bipolar disorder",
"2" = "Only psychotic disorder",
"3" = "Only bipolar disorder")
)
#Check results
glad_signup_psychosis_and_bipolar %>%
group_by(psychotic_and_biploar_disorder_labelled) %>%
count()
glad_signup_psychosis_and_bipolar$autistic_spectrum_disorder <- factor(
glad_signup_psychosis_and_bipolar$mhd.asd,
levels = c(0, 1),
labels = c("No autistic spectrum disorder", "Autistic spectrum disorder")
)
#Check results
glad_signup_psychosis_and_bipolar %>%
group_by(autistic_spectrum_disorder) %>%
count()
glad_signup_psychosis_and_bipolar$ADHD_ADD_labelled <- factor(
glad_signup_psychosis_and_bipolar$mhd.addadhd,
levels = c(0, 1),
labels = c("No ADHD or ADD disorder", "ADHD or ADD disorder")
)
#Check results
glad_signup_psychosis_and_bipolar %>%
group_by(ADHD_ADD_labelled) %>%
count()
#Put disorder variables into a character vector
mental_health_disorders <- c(
"depressive_disorder",
"anxiety_disorder",
"mhd.ptsd",
"OCRDs",
"eating_disorders",
"mhd.personality_disorder",
"psychotic_disorder",
"mhd.bipolar_disorder",
"mhd.asd",
"mhd.addadhd"
)
#Calculate every pt's total disorders with row sums
glad_signup_total_MH_disorders <- glad_signup_psychosis_and_bipolar %>%
mutate(
MH_disorders_total_count =
rowSums(.[mental_health_disorders])
)
#Check results
glad_signup_total_MH_disorders %>%
freq(MH_disorders_total_count)
glad_signup_MH_comorbidity <- glad_signup_total_MH_disorders %>%
mutate(mental_health_comorbidities =
case_when(
MH_disorders_total_count <= 1 ~ 0,
MH_disorders_total_count > 1 ~ 1
))
glad_signup_MH_comorbidity$mental_health_comorbidities_labelled <- factor(
glad_signup_MH_comorbidity$mental_health_comorbidities,
levels = c(0, 1),
labels = c("No mental health comorbidity", "1+ mental health comorbidity"))
#Check results
glad_signup_MH_comorbidity %>%
group_by(mental_health_comorbidities_labelled) %>%
count()
#Old physical health variables object doesn't have the recoded vars, so we need
#a new object with the recoded variable names instead
physical_health_comorbidity_variables_recode <- c(
"dem.epilepsy_or_convulsions",
"diabetes_type_I_or_II",
"dem.high_blood_pressure",
"dem.high_blood_cholesterol",
"dem.stroke",
"dem.migraines"
)
#Calculate every pt's total disorders with row sums
glad_signup_total_phy_disorders <- glad_signup_MH_comorbidity %>%
mutate(
phy_disorders_total_count =
rowSums(.[physical_health_comorbidity_variables_recode])
)
#Check results
glad_signup_total_phy_disorders %>%
freq(phy_disorders_total_count)
glad_signup_phy_comorbidities <- glad_signup_total_phy_disorders %>%
mutate(physical_health_comorbidities =
case_when(
phy_disorders_total_count <= 1 ~ 0,
phy_disorders_total_count > 1 ~ 1
))
glad_signup_phy_comorbidities$physical_health_comorbidities_labelled <- factor(
glad_signup_phy_comorbidities$physical_health_comorbidities,
levels = c(0, 1),
labels = c("No physical health comorbidities", "1+ physical health comorbidity")
)
#Check distribution
glad_signup_phy_comorbidities %>%
group_by(physical_health_comorbidities_labelled) %>%
count()
glad_signup_completed_baseline <- glad_signup_MH_comorbidity %>%
mutate(completed_baseline =
case_when(
externalDataReference %in% COPING_GLAD_invitations$participant_id &
externalDataReference %in% COPING_GLAD_base_clean$externalDataReference ~ 1,
externalDataReference %in% COPING_GLAD_invitations$participant_id &
externalDataReference %not_in% COPING_GLAD_base_clean$externalDataReference ~ 0
))
glad_signup_completed_baseline$completed_baseline_labelled <- factor(
glad_signup_completed_baseline$completed_baseline,
levels = c(0, 1),
labels = c("Did not complete COPING baseline", "Completed COPING baseline")
)
#Check results
glad_signup_completed_baseline %>%
group_by(completed_baseline_labelled) %>%
count() #N is slightly lower than IDs in the COPING GLAD baseline?
#Must be because of the extra invitations filter?
COPING_GLAD_base_clean %>%
dim()
# MAY 2 (wave 1) - FOLLOW UP A
start1 <- as.POSIXct("2020-05-19")
end1 <-  as.POSIXct("2020-06-02")
# JUNE 1 (wave 2) - FOLLOW UP B
start2 <- as.POSIXct("2020-06-02")
end2<-  as.POSIXct("2020-06-16")
# JUNE 2 (wave 3) - FOLLOW UP A
start3 <- as.POSIXct("2020-06-16")
end3 <-  as.POSIXct("2020-06-30")
# JULY 1 (wave 4) - FOLLOW UP B
start4 <- as.POSIXct("2020-06-30")
end4<-  as.POSIXct("2020-07-14")
# JULY 2 (wave 5) - FOLLOW UP A
start5 <- as.POSIXct("2020-07-14")
end5 <-  as.POSIXct("2020-07-28") ##Ongoing starts from here
# JULY - AUG (wave 6) - FOLLOW UP B
start6 <- as.POSIXct("2020-07-28")
end6 <-  as.POSIXct("2020-08-25")
# AUG - SEPT (wave 7) - FOLLOW UP A
start7 <- as.POSIXct("2020-08-25")
end7 <-  as.POSIXct("2020-09-22")
# SEPT - OCT (wave 8) - FOLLOW UP B
start8 <- as.POSIXct("2020-09-22")
end8 <-  as.POSIXct("2020-10-20")
# OCT - NOV (wave 9) - FOLLOW UP A
start9 <- as.POSIXct("2020-10-20")
end9 <-  as.POSIXct("2020-11-17")
# NOV - DEC (wave 10) - FOLLOW UP B
start10 <- as.POSIXct("2020-11-17")
end10 <-  as.POSIXct("2020-12-15")
# DEC - JAN (wave 11) - FOLLOW UP A
start11 <- as.POSIXct("2020-12-15")
end11 <-  as.POSIXct("2021-01-12")
#Jan - Feb (wave 12) - FOLLOW UP B
start12 <- as.POSIXct("2021-01-12")
end12 <- as.POSIXct("2021-02-09")
#Feb - March (wave 13) - FOLLOW UP A
start13 <- as.POSIXct("2021-02-09")
end13 <- as.POSIXct("2021-03-09")
#March - April (wave 14) - FOLLOW UP B
start14 <- as.POSIXct("2021-03-09")
end14 <- as.POSIXct("2021-04-06")
#April - May (wave 15) - FOLLOW UP A
start15 <- as.POSIXct("2021-04-06")
end15 <- as.POSIXct("2021-05-04")
COPING_followup_A_dem_waves <- COPING_followup_A_dem_merged %>%
mutate(COPING_waves_A =
case_when(
startDate >= start1 &
startDate < end1 ~ ".Wave_1",
startDate >= start3 &
startDate < end3 ~ ".Wave_3",
startDate >= start5 &
startDate < end5 ~ ".Wave_5",
startDate >= start7 &
startDate < end7 ~ ".Wave_7",
startDate >= start9 &
startDate< end9 ~ ".Wave_9",
startDate >= start11 &
startDate < end11 ~ ".Wave_11",
startDate >= start13 &
startDate < end13 ~ ".Wave_13",
startDate >= start15 &
startDate < end15 ~ ".Wave_15",
startDate >= start2 &
startDate < end2 ~ ".Wave_2_QA",
startDate >= start4 &
startDate < end4 ~ ".Wave_4_QA",
startDate >= start6 &
startDate < end6 ~ ".Wave_6_QA",
startDate >= start8 &
startDate < end8 ~ ".Wave_8_QA",
startDate >= start10 &
startDate < end10 ~ ".Wave_10_QA",
startDate >= start12 &
startDate < end12 ~ ".Wave_12_QA",
startDate >= start14 &
startDate < end14 ~ ".Wave_14_QA"
))
#Note: QA are questionnaires that are A FOLLOW UP QUESTIONNAIRES but answered within a time point that was considered a "follow up B time-point"
COPING_followup_B_phq_waves <- COPING_followup_B_phq_raw %>%
mutate(COPING_waves_B =
case_when(
startDate >= start1 &
startDate < end1 ~ ".Wave_1_QB",
startDate >= start3 &
startDate < end3 ~ ".Wave_3_QB",
startDate >= start5 &
startDate < end5 ~ ".Wave_5_QB",
startDate >= start7 &
startDate < end7 ~ ".Wave_7_QB",
startDate >= start9 &
startDate< end9 ~ ".Wave_9_QB",
startDate >= start11 &
startDate < end11 ~ ".Wave_11_QB",
startDate >= start13 &
startDate < end13 ~ ".Wave_13_QB",
startDate >= start15 &
startDate < end15 ~ ".Wave_15_QB",
startDate >= start2 &
startDate < end2 ~ ".Wave_2",
startDate >= start4 &
startDate < end4 ~ ".Wave_4",
startDate >= start6 &
startDate < end6 ~ ".Wave_6",
startDate >= start8 &
startDate < end8 ~ ".Wave_8",
startDate >= start10 &
startDate < end10 ~ ".Wave_10",
startDate >= start12 &
startDate < end12 ~ ".Wave_12",
startDate >= start14 &
startDate < end14 ~ ".Wave_14"
))
COPING_followup_A_dem_waves %>%
freq(COPING_waves_A)
COPING_followup_B_phq_waves %>%
freq(COPING_waves_B)
COPING_followup_A_wave_1 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_1")
COPING_followup_A_wave_3 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_3")
COPING_followup_A_wave_5 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_5")
COPING_followup_A_wave_7 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_7")
COPING_followup_A_wave_9 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_9")
COPING_followup_A_wave_11 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_11")
COPING_followup_A_wave_13 <- COPING_followup_A_dem_waves %>%
filter(COPING_waves_A == ".Wave_13")
COPING_followup_B_wave_2 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_2")
COPING_followup_B_wave_4 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_4")
COPING_followup_B_wave_6 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_6")
COPING_followup_B_wave_8 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_8")
COPING_followup_B_wave_10 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_10")
COPING_followup_B_wave_12 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_12")
COPING_followup_B_wave_14 <- COPING_followup_B_phq_waves %>%
filter(COPING_waves_B == ".Wave_14")
#Put the wave data sets into a new list
COPING_waves_tib_list <- list(COPING_followup_A_wave_1,
COPING_followup_B_wave_2,
COPING_followup_A_wave_3,
COPING_followup_B_wave_4,
COPING_followup_A_wave_5,
COPING_followup_B_wave_6,
COPING_followup_A_wave_7,
COPING_followup_B_wave_8,
COPING_followup_A_wave_9,
COPING_followup_B_wave_10,
COPING_followup_A_wave_11,
COPING_followup_B_wave_12,
COPING_followup_A_wave_13,
COPING_followup_B_wave_14)
COPING_waves_tib_list_cleansIDs <- COPING_waves_tib_list %>%
map(distinct,
externalDataReference,
.keep_all = TRUE)
COPING_waves_tib_list_cleansIDs <- COPING_waves_tib_list_cleansIDs %>%
map(drop_na,
externalDataReference)
#Create a character vector of the new column names for the waves in the GLAD
#sign up
GLAD_signup_wave_col_names <- c(
"completed_wave_1",
"completed_wave_2",
"completed_wave_3",
"completed_wave_4",
"completed_wave_5",
"completed_wave_6",
"completed_wave_7",
"completed_wave_8",
"completed_wave_9",
"completed_wave_10",
"completed_wave_11",
"completed_wave_12",
"completed_wave_13",
"completed_wave_14"
)
#Create N completed wave variable in GLAD sign up for each COPING object
GLAD_signup_waves <- COPING_waves_tib_list %>%
map2(GLAD_signup_wave_col_names, function(x, y){
df <- glad_signup_completed_baseline %>%
mutate(!!y :=
case_when(
externalDataReference %in% x$externalDataReference ~ 1,
externalDataReference %not_in% x$externalDataReference ~ 0
))
return(df)
})
GLAD_signup_waves_merged <- GLAD_signup_waves %>%
reduce(full_join)
#Check data
GLAD_signup_waves_merged %>%
dim()
GLAD_signup_waves_merged %>%
colnames()
#See distribution for each variable
GLAD_signup_wave_col_names %>%
map(function(x){
group_by_at(GLAD_signup_waves_merged, x) %>%
summarise(Count = n()) %>%
as_tibble()
})
#Calculate every pt's total disorders with row sums
glad_signup_total_waves <- GLAD_signup_waves_merged %>%
mutate(
total_COPING_waves =
rowSums(.[GLAD_signup_wave_col_names])
)
#Check results
glad_signup_total_waves %>%
freq(total_COPING_waves)
#Check results
glad_signup_total_waves %>%
freq(joined_coping_first_invitation)
glad_signup_final <- glad_signup_total_waves %>%
filter(age_cleaned >= 16 &
age_cleaned <= 117) %>%  #41,142, 28 pt's removed
filter(!is.na(gender_recode_labelled)) %>% #40,271, 871 pt's removed
filter(joined_coping_first_invitation == "Not applicable")
#Check results
glad_signup_total_waves %>%
dim()
glad_signup_total_waves %>%
dim()
glad_signup_final %>%
dim()
glad_signup_final <- glad_signup_total_waves %>%
filter(age_cleaned >= 16 &
age_cleaned <= 117) %>%  #41,142, 28 pt's removed
filter(!is.na(gender_recode_labelled)) %>% #40,271, 871 pt's removed
filter(joined_coping_first_invitation != "Not applicable")
glad_signup_total_waves %>%
dim()
glad_signup_final %>%
dim()
40271 - 34285
processed_data_path
write_rds(glad_signup_final, paste0(processed_data_path, "glad_coping_participation.rds"))
glad_signup_final %>%
colnames()

size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2, 0.5),
limits = c(0, 2)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
width = .2,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
width = 1,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
#width = 1,
position = position_dodge(.9),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin  = CI_95_low,
ymax  = CI_95_up),
size = 0.7,
#width = 1,
#position = position_dodge(.9),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin = CI_95_low,
ymax = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
?geom_errorbar
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(data = ZINB_model_or_CI, aes(ymin = CI_95_low,
ymax = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(data = ZINB_model_or_CI, aes(ymin = CI_95_low,
ymax = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin = CI_95_low,
ymax = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
ZINB_model_or_CI %>%
slice(-1) %>% #remove row number 1 (The intercept)
ggplot(aes(x = Independent_variable, y = Estimate)) +
geom_point(shape = 15,
size = 1,
#position = position_dodge(width = NULL),
color = "black") +
geom_errorbar(aes(ymin = CI_95_low,
ymax = CI_95_up),
size = 0.7,
#position = position_dodge(width = NULL),
color = "#EFC10B",
stat = "identity") +
labs(title = "ZINB model of COPING follow-up surveys",
x = "Explanatory variables",
y = "Adjusted rate ratios with 95% CI") +
coord_flip() +
scale_y_continuous(breaks = seq(0, 2.5, 0.5),
limits = c(0, 2.5)) +
scale_x_discrete(limits = rev) +
geom_hline(yintercept = 1, color = "red", size = 1) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(colour = "black"),
axis.ticks = element_line(color = "black"))
knitr::opts_chunk$set(echo = TRUE)
remove(list = ls())
#Change it to "= 0" to turn it back on
options(scipen = 999)
#install.packages("broom")
#install.packages("knitr)
#install.packages("car")
#install.packages("rstatix")
#install.packages("pscl")
#install.packages("boot")
#install.packages("stats")
#install.packages("rcompanion")
#install.packages("MASS")
#install.packages("openxlsx")
#install.packages("tidyverse")
library(broom)
library(knitr)
library(car)
library(rstatix)
library(pscl)
library(boot)
library(stats)
library(rcompanion)
library(MASS)
library(openxlsx)
library(tidyverse)
source("..//COPING_participation_paths.r")
source("..//COPING_participation_functions.r")
glad_coping_participation <- read_rds(paste0(processed_data_path, processed_data_name))
#Check data
glad_coping_participation %>%
head()
#Create explanatory variables vector
explanatory_variables <- c(
"age_cleaned",
"gender_recode_labelled",
"highest_education_labelled",
"ethnicity_labelled",
"employment_labelled",
"partnership_status_labelled",
"phq.sum_score",
"gad.sum_score",
"audit.sum_score",
"smoking_status_labelled",
"physical_health_comorbidities_labelled",
"MH_disorders_total_count",
"depressive_and_anxiety_comorbidity_labelled",
"eating_disorders_labelled",
"OCRDs_labelled",
"psychotic_and_biploar_disorder_labelled",
"asd_labelled",
"ADHD_ADD_labelled",
"personality_disorder_labelled",
#"PTSD_labelled", # Hasing this out because it turns to NA in models after adding anx/dep comorbidity
"startDate",
"kit_returned_labelled"
#joined_coping_first_invitation_labelled,
)
#Create dependent variable vectors
coping_baseline_outcome <- c("completed_baseline_labelled")
coping_followups_outcome <- c("total_COPING_waves")
providing_kit_outcome <- c("kit_returned_labelled")
ZINB_model1_variables <- c(
"age_cleaned",
"gender_recode_labelled",
"highest_education_labelled",
"ethnicity_labelled",
"employment_labelled",
"partnership_status_labelled",
"phq.sum_score",
"gad.sum_score",
"audit.sum_score",
"smoking_status_labelled",
"physical_health_comorbidities_labelled",
"MH_disorders_total_count",
"depressive_and_anxiety_comorbidity_labelled",
"eating_disorders_labelled",
"OCRDs_labelled",
"psychotic_and_biploar_disorder_labelled",
"asd_labelled",
"ADHD_ADD_labelled",
"personality_disorder_labelled",
#"PTSD_labelled", #Causes an error after adding anx/dep comorbidity variable
"kit_returned_labelled"
#"startDate" #Throws error
)
#Explanatory variables for exploratory models
##Exploratory model 1: Without the saliva kit variable
exploratory_ZINB_model1_variables <- ZINB_model1_variables %>%
str_subset(pattern = "kit_returned_labelled",
negate = TRUE)
##Exploratory model 2: Only pt's who have provided a saliva kit
exploratory_ZINB_model2_variables <- exploratory_ZINB_model1_variables
#Main aim1 formula
aim1_baseline_participation_formula <- as.formula(paste(coping_baseline_outcome,
paste(explanatory_variables,
collapse=" + "),
sep = " ~ "))
#Exploratory aim1 formulas
##Exploratory model 1: Omitting the saliva kit variable
exploratory_LR_model1_explan_vars <- explanatory_variables %>%
str_subset(pattern = "kit_returned_labelled",
negate = TRUE)
exploratory_LR_model1_formula <- as.formula(paste(coping_baseline_outcome,
paste(exploratory_LR_model1_explan_vars,
collapse=" + "),
sep = " ~ "))
##Exploratory model 2: Only participants who have returned a saliva kit
exploratory_LR_model2_explan_vars <- explanatory_variables %>%
str_subset(pattern = "kit_returned_labelled",
negate = TRUE)
exploratory_LR_model2_formula <- as.formula(paste(coping_baseline_outcome,
paste(exploratory_LR_model2_explan_vars,
collapse=" + "),
sep = " ~ "))
##Exploratory model 3: Providing a saliva kit as the outcome variable
exploratory_LR_model3_explan_vars <- explanatory_variables %>%
str_subset(pattern = "kit_returned_labelled",
negate = TRUE)
exploratory_LR_model3_formula <- as.formula(paste(providing_kit_outcome,
paste(exploratory_LR_model3_explan_vars,
collapse=" + "),
sep = " ~ "))
#Explanatory aim2 model formulas
##Explanatory model 1: Without the saliva kit variable
exploratory_ZINB_model1_exclude_vars <- c("kit_returned_labelled|startDate")
exploratory_ZINB_model1_explan_vars <- explanatory_variables %>%
str_subset(pattern = exploratory_ZINB_model1_exclude_vars,
negate = TRUE)
exploratory_ZINB_model1_formula <- as.formula(paste(coping_baseline_outcome,
paste(exploratory_ZINB_model1_explan_vars,
collapse=" + "),
sep = " ~ "))
##Explanatory model 2: Only pt's who returned their saliva kit
exploratory_ZINB_model2_formula <- exploratory_ZINB_model1_formula
aim1_LR_model_names <- c(
"Intercept",
"age_cleaned",
"gender_recode_labelledFemale",
"gender_recode_labelledNon-binary/prefer to self-define",
"highest_education_labelledA levels/AS levels or equivalent",
"highest_education_labelledO levels/GCSEs or CSEs or equivalent",
"highest_education_labelledNVQ or HND or HNC or equivalent",
"highest_education_labelledNone of the above",
"ethnicity_labelledMixed",
"ethnicity_labelledAsian or Asian British",
"ethnicity_labelledBlack or Black British",
"ethnicity_labelledArab",
"ethnicity_labelledOther",
"employment_labelledRetired",
"employment_labelledLooking after home and/or family",
"employment_labelledUnable to work because of sickness or disability",
"employment_labelledUnemployed",
"employment_labelledDoing unpaid or voluntary work",
"employment_labelledFull or part-time_student",
"employment_labelledNone of the above",
"partnership_status_labelledRelationship or married/civil partnership",
"partnership_status_labelledDivorced/widowed/separated",
"phq.sum_score",
"gad.sum_score",
"audit.sum_score",
"smoking_status_labelledI smoke now",
"smoking_status_labelledI used to smoke",
"physical_health_comorbidities_labelled1 physical health disorder",
"physical_health_comorbidities_labelled2+ physical health disorders",
"MH_disorders_total_count",
"depressive_and_anxiety_comorbidity_labelledNo depressive and anxiety disorder",
"depressive_and_anxiety_comorbidity_labelledDepressive disorder only",
"depressive_and_anxiety_comorbidity_labelledAnxiety disorder only",
"eating_disorders_labelledEating disorder",
"OCRDs_labelledOCRDs",
"psychotic_and_biploar_disorder_labelledPsychotic and bipolar disorder",
"psychotic_and_biploar_disorder_labelledOnly psychotic disorder",
"psychotic_and_biploar_disorder_labelledOnly bipolar disorder",
"asd_labelledAutistic spectrum disorder",
"ADHD_ADD_labelledADHD or ADD disorder",
"mhd.personality_disorder_labelledPersonality disorder",
#"PTSD_labelledPost-traumatic stress disorder", # turns to NA in models after adding anx/dep comorbidity
"startDate",
"kit_returnedPt has provided saliva kit"
#"joined_coping_first_invitationCompleted COPING baseline before 1st follow-up"
)
#Exploratory model 1: Remove the saliva kit provided variable
exploratory_LR_model1_names <- aim1_LR_model_names %>%
str_subset(pattern = "kit_returnedPt has provided saliva kit",
negate = TRUE)
#Exploratory model 2: Only pt's who have provided a saliva kit
exploratory_LR_model2_names <- exploratory_LR_model1_names
#Exploratory model 3: Providing a saliva kit as the outcome variable
exploratory_LR_model3_names <- exploratory_LR_model1_names
glad_coping_participation_returned_kit <- glad_coping_participation %>%
filter(kit_returned == 1)
#We want the depression/anxiety comorbidity to be the reference group because it has the largest N
##Full sample
glad_coping_participation$depressive_and_anxiety_comorbidity_labelled <- relevel(glad_coping_participation$depressive_and_anxiety_comorbidity_labelled,
ref = "Depressive and anxiety disorder")
##Pt's who have provided a kit
glad_coping_participation_returned_kit$depressive_and_anxiety_comorbidity_labelled <- relevel(glad_coping_participation_returned_kit$depressive_and_anxiety_comorbidity_labelled,
ref = "Depressive and anxiety disorder")
#Create p-value and no. of test objects
standard_p_value_level <- 0.05
aim1_model_n_tests <- 42
aim2_model_n_tests <- 41
exploratory_ZINB_model_n_tests <- 40
#Create adjusted p value thresholds
aim1_adjusted_sig_threshold <- format.pval(pv = standard_p_value_level / aim1_model_n_tests,
digits = 3)
aim2_adjusted_sig_threshold <- format.pval(pv = standard_p_value_level / aim2_model_n_tests,
digits = 3)
exploratory_ZINB_adjusted_sig_threshold <- format.pval(pv = standard_p_value_level / exploratory_ZINB_model_n_tests,
digits = 3)
#Check thresholds
aim1_adjusted_sig_threshold
aim2_adjusted_sig_threshold #Exploratory LR model 1 and 2 will also use same threshold
exploratory_ZINB_adjusted_sig_threshold
